<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>综合管理系统</title>
    <link href="../css/user_public.css" rel="stylesheet" type="text/css" />
    <link href="../css/user_head.css" rel="stylesheet" type="text/css" />
    <link href="../css/convert.css" rel="stylesheet" type="text/css" />
    <link href="../css/tg_style.css" rel="stylesheet" type="text/css" />
    <link href="../css/head.css" rel="stylesheet" type="text/css" />
    <link href="../css/i_public.css" rel="stylesheet" type="text/css" />
    <link href="../css/public.css" rel="stylesheet" type="text/css" />
    <link href="../css/pagercss.css" rel="stylesheet" type="text/css" />
    <link href="../css/table.css" rel="stylesheet" type="text/css" />
    <script src="../js/basic/base64code.js" type="text/javascript"></script>
    <script src="../js/basic/Calendar.js" type="text/javascript"></script>
    <script src="../js/basic/index.js" type="text/javascript"></script>
    <script src="../js/util/jscookie.js"></script>
    <script src="../js/util/local_storage.js"></script>
    <script src="../js/util/stores.js"></script>
    <script src="../js/basic/jquery.js" type="text/javascript"></script>
    <script src="../js/util/control.js" type="text/javascript"></script>
    <script src="../js/util/util.js" type="text/javascript"></script>
    <script src="../js/util/pager.js" type="text/javascript"></script>
    <script src="../js/util/webservice.js" type="text/javascript"></script>
    <script src="../js/sql/dict.js" type="text/javascript"></script>
    <script src="../js/sql/stock_plan.js" type="text/javascript"></script>
    <script src="../js/sql/stock_info.js"></script>
    <script src="../js/basic/tableSort.js"></script>
    <script type="text/javascript">
        var readFinish = true;
        var timer;
        function page_load() {
            $("#客户IDi").val(get_url_para(window.location.href, "userId"));
            //$("#状态s").val(get_url_para(window.location.href, "staId"));
            if (getCookie("sys_is_investor", 1) > 0) {
                stock_plan_GetTask();
                setInterval("stock_plan_GetTask()", 2000);
                //setInterval("pagerQry()", 5000);
            }
            else {
                $("#待匹配A").hide();
                $("#待平仓A").hide();
            }
            search();

            $("#导出每日数据s").val(get_today_str());
            $("#导出每日数据e").val(get_today_str());
        }
        function search() {
            if (readFinish) {
                if (row_count == -1)
                    stock_plan_GetCount($("#方案IDi").val(), $("#客户IDi").val(), $("#状态s").val(), "", "", "", $("#持仓截止s").val(),
                         $("#持仓截止e").val(), $("#股票代码i").val(), $("#股票名称i").val(), $("#点买额度s").val(), $("#点买额度e").val());
                stock_plan_GetList("qryBtn", "查询列表", "stock_plan_list2", $("#方案IDi").val(), $("#客户IDi").val(), $("#状态s").val(), "", "", "", $("#持仓截止s").val(),
                         $("#持仓截止e").val(), $("#股票代码i").val(), $("#股票名称i").val(), $("#点买额度s").val(), $("#点买额度e").val(),
                         "id desc", page_size, page_index);
            }
            timer = setInterval("calcProfit()", 800);
        }
        function getList(staId) {
            $("#状态s").val(staId);
            pagerQry();
        }
        function calcProfit() {
            var stock_nos = "";
            var tableObj = document.getElementById("查询列表");
            for (var i = 0; i < tableObj.rows.length; i++) {
                if (tableObj.rows[i].cells[13].innerText != "持仓中" &&
                    tableObj.rows[i].cells[13].innerText != "待平仓") continue;
                if (stock_nos.indexOf(tableObj.rows[i].cells[3].innerText) < 0) {
                    stock_nos += ("," + tableObj.rows[i].cells[3].innerText);
                }
            }
            if (stock_nos.length > 0) {
                stock_nos = stock_nos.substr(1);
                stock_info_GetNowPriceMul(stock_nos);
            }

            var now = new Date();
            var nowi = now.getHours() * 60 + now.getMinutes();
            if (nowi < 555 || (nowi > 690 && nowi < 780) || nowi > 900) {
                window.clearInterval(timer);
            }
        }
        function exp() {
            stock_plan_Exp("expBtn", $("#方案IDi").val(), $("#客户IDi").val(), $("#状态s").val(), "", "", "", $("#持仓截止s").val(),
                         $("#持仓截止e").val(), $("#股票代码i").val(), $("#股票名称i").val(), $("#点买额度s").val(), $("#点买额度e").val(),
                         "id desc");
        }
        function exp2() {
            stock_plan_ExpToday("expBtn2", $("#导出每日数据s").val(), $("#导出每日数据e").val());
        }
    </script>
</head>
<body onload="page_load()">
    <div class="contbg m_t-10">
        <div class="w1000 cen m" style="width: 100%">
            <div class="contbox" style="width: 100%">
                <div class="contright" style="width: 100%">
                    <div class="mt c_b p_l30 f-w f-e43">
                        持仓管理
                    </div>
                    <div class="contmc">
                        <div class="mc mclist">
                            <table class="query">
                                <tr>
                                    <td>
                                        <span>方案ID:</span>
                                        <input id="方案IDi" style="width: 10%" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" />
                                        <span>客户ID:</span>
                                        <input id="客户IDi" style="width: 10%" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" />
                                        <span>状态:</span>
                                        <select id="状态s" style="width: 10%">
                                            <option value="2,3,4,5,6,7">全部</option>
                                            <option value="2">交易中</option>
                                            <option value="3" selected="selected">持仓中</option>
                                            <option value="4">待平仓</option>
                                            <option value="5">平仓中</option>
                                            <option value="6">待结算</option>
                                            <option value="7">已结算</option>
                                        </select>
                                        <span>持仓截止:</span>
                                        <input id="持仓截止s" style="width: 10%" onclick="SelectDate(this)" />
                                        <span>~</span>
                                        <input id="持仓截止e" style="width: 10%" onclick="SelectDate(this)" />
                                        <br />
                                        <span>股票代码:</span>
                                        <input id="股票代码i" style="width: 10%" />
                                        <span>股票名称:</span>
                                        <input id="股票名称i" style="width: 10%" />
                                        <span>点买额度:</span>
                                        <input id="点买额度s" style="width: 10%" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" />
                                        <span>~</span>
                                        <input id="点买额度e" style="width: 10%" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <center>
                                            <input id="qryBtn" type="submit" value="查询" class="fore_end btn-red" onclick="pagerQry()" />
                                            &nbsp;&nbsp;
                                            <button id="expBtn" onclick="exp()" class="fore_end btn-red">
                                                导出结果
                                            </button>&nbsp; <a id="导出结果" href="javascript:void(0)"></a>
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
                                            <a id="待匹配A" href="list1.htm" style='color: blue; font-weight: bolder'>待匹配(..)</a>
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            <a id="待平仓A" href="javascript:getList(4)" style='color: blue; font-weight: bolder'>待平仓(..)</a>
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            <a id="平仓中A" href="javascript:getList(5)" style='color: blue; font-weight: bolder'>平仓中(..)</a>
                                        </center>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <center>
                                            导出每日数据：
                                            <input id="导出每日数据s" style="width: 10%" onclick="SelectDate(this)" />
                                            <span>~</span>
                                            <input id="导出每日数据e" style="width: 10%" onclick="SelectDate(this)" />
                                            &nbsp;&nbsp;
                                            <button id="expBtn2" onclick="exp2()" class="fore_end btn-red">
                                                导出结果
                                            </button>&nbsp; <a id="导出结果2" href="javascript:void(0)"></a>
                                        </center>
                                    </td>
                                </tr>
                            </table>
                            <table id="查询列表" width="100%" class="table1" cellspacing="0"></table>
                            <table width="100%">
                                <tr>
                                    <td align="right" class="table_label_col">
                                        <div class="m c_b km-t">
                                            <div id="pagerDiv" class="f_r pagin">
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="c_b f-s1">
                    &nbsp;
                </div>
            </div>
        </div>
    </div>
</body>
</html>
